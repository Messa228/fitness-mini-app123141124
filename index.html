<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">

<meta name="viewport"
  content="width=device-width,
  initial-scale=1,
  maximum-scale=1,
  user-scalable=no">

<title>Fitness Mini App</title>

<script src="https://telegram.org/js/telegram-web-app.js"></script>

<style>
*{box-sizing:border-box}
body{
  margin:0;
  font-family:Arial,sans-serif;
  background:#f4f4f4;
}

.screen{
  display:none;
  position:fixed;
  inset:0;
  padding:16px;
  overflow-y:auto;
  background:#f4f4f4;
}
.screen.active{display:block}

.big-btn{
  flex:1;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:24px;
  background:white;
  border-bottom:1px solid #ddd;
}

#home{
  display:flex;
  flex-direction:column;
}

.section{
  margin-bottom:20px;
  background:white;
  padding:10px;
  border-radius:8px;
}

.item{
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding:8px 0;
}

.big-check{
  width:24px;
  height:24px;
}

.plus{
  font-size:26px;
  cursor:pointer;
}

.progress{
  height:10px;
  background:#ddd;
  border-radius:5px;
  overflow:hidden;
}
.progress-inner{
  height:100%;
  background:#4caf50;
  width:0%;
}

input,textarea,button{
  width:100%;
  padding:8px;
  margin-top:6px;
  font-size:16px;
}
</style>
</head>

<body>

<!-- HOME -->
<div id="home" class="screen active">
  <div class="big-btn" onclick="openScreen('food')">üçΩ –ï–î–ê</div>
  <div class="big-btn" onclick="openScreen('workout')">üèãÔ∏è –¢–†–ï–ù–ò–†–û–í–ö–ò</div>
  <div class="big-btn" onclick="openScreen('stats')">üìä –°–¢–ê–¢–ò–°–¢–ò–ö–ê</div>
</div>

<!-- ================= –ï–î–ê ================= -->
<div id="food" class="screen">
  <h2>–ï–¥–∞</h2>

  <!-- ===== –ó–ê–í–¢–†–ê–ö ===== -->
  <div class="meal-block">
    <h3>–ó–∞–≤—Ç—Ä–∞–∫</h3>
    <div id="breakfastList"></div>
    <div class="add-btn" onclick="openAddFood('breakfast')">+</div>
  </div>

  <!-- ===== –û–ë–ï–î ===== -->
  <div class="meal-block">
    <h3>–û–±–µ–¥</h3>
    <div id="lunchList"></div>
    <div class="add-btn" onclick="openAddFood('lunch')">+</div>
  </div>

  <!-- ===== –£–ñ–ò–ù ===== -->
  <div class="meal-block">
    <h3>–£–∂–∏–Ω</h3>
    <div id="dinnerList"></div>
    <div class="add-btn" onclick="openAddFood('dinner')">+</div>
  </div>

  <!-- ===== –í–û–î–ê ===== -->
  <div class="water-box">
    <div style="display:flex;justify-content:space-between;align-items:center;">
      <h3>–í–æ–¥–∞</h3>
      <span onclick="editWaterGoal()" style="cursor:pointer;">‚úèÔ∏è</span>
    </div>

    <p>–¶–µ–ª—å: <span id="waterGoalText">2000</span> –º–ª</p>

    <input type="number" id="waterInput" placeholder="–°–∫–æ–ª—å–∫–æ –≤—ã–ø–∏–ª (–º–ª)">
    <button onclick="addWater()">+</button>

    <div class="water-progress">
      <div id="waterProgress"></div>
    </div>

    <p>–í—ã–ø–∏—Ç–æ: <span id="waterDone">0</span> –º–ª</p>
    <p>–û—Å—Ç–∞–ª–æ—Å—å: <span id="waterLeft">2000</span> –º–ª</p>

    <button onclick="resetWater()">–°–±—Ä–æ—Å–∏—Ç—å –≤–æ–¥—É</button>
  </div>

  <button onclick="goHome()">‚Üê –ù–∞–∑–∞–¥</button>
</div>


<!-- FOOD EDITOR -->
<div id="foodEditor" class="screen">
  <h2>–ë–ª—é–¥–æ</h2>
  <input id="foodName" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ">
  <textarea id="foodComp" placeholder="–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∏ –≥—Ä–∞–º–º—ã"></textarea>
  <button onclick="saveFood()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
  <button onclick="deleteFood()">–£–¥–∞–ª–∏—Ç—å</button>
  <button onclick="openScreen('food')">‚Üê –ù–∞–∑–∞–¥</button>
</div>

<!-- WORKOUT -->
<div id="workout" class="screen">
  <h2>–¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏</h2>

  <div class="section">
    <h3>–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫ <span class="plus" onclick="addEx('mon')">+</span></h3>
    <div id="mon"></div>
  </div>

  <div class="section">
    <h3>–°—Ä–µ–¥–∞ <span class="plus" onclick="addEx('wed')">+</span></h3>
    <div id="wed"></div>
  </div>

  <div class="section">
    <h3>–ü—è—Ç–Ω–∏—Ü–∞ <span class="plus" onclick="addEx('fri')">+</span></h3>
    <div id="fri"></div>
  </div>

  <button onclick="openScreen('home')">‚Üê –ù–∞–∑–∞–¥</button>
</div>

<!-- WORKOUT EDITOR -->
<div id="workoutEditor" class="screen">
  <h2>–£–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ</h2>
  <input id="exName" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ">
  <input id="exSets" type="number" placeholder="–ü–æ–¥—Ö–æ–¥—ã">
  <button onclick="saveEx()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
  <button onclick="deleteEx()">–£–¥–∞–ª–∏—Ç—å</button>
  <button onclick="openScreen('workout')">‚Üê –ù–∞–∑–∞–¥</button>
</div>

<!-- STATS -->
<div id="stats" class="screen">
  <h2>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h2>
  <button onclick="openScreen('home')">‚Üê –ù–∞–∑–∞–¥</button>
</div>

<script>
Telegram.WebApp.ready();
Telegram.WebApp.expand();

let currentFood=null,currentMeal=null;
let currentEx=null,currentDay=null;

function openScreen(id){
  document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active'));
  document.getElementById(id).classList.add('active');
}

/* FOOD */
function addFood(meal){
  currentMeal=meal;
  currentFood=null;
  foodName.value='';
  foodComp.value='';
  openScreen('foodEditor');
}

function saveFood(){
  const list=JSON.parse(localStorage.getItem(currentMeal)||'[]');
  if(currentFood==null){
    list.push({name:foodName.value,comp:foodComp.value,eaten:false});
  }else{
    list[currentFood].name=foodName.value;
    list[currentFood].comp=foodComp.value;
  }
  localStorage.setItem(currentMeal,JSON.stringify(list));
  renderFood();
  openScreen('food');
}

function deleteFood(){
  if(currentFood==null)return;
  const list=JSON.parse(localStorage.getItem(currentMeal));
  list.splice(currentFood,1);
  localStorage.setItem(currentMeal,JSON.stringify(list));
  renderFood();
  openScreen('food');
}

function renderFood(){
  ['breakfast','lunch','dinner'].forEach(meal=>{
    const box=document.getElementById(meal);
    box.innerHTML='';
    const list=JSON.parse(localStorage.getItem(meal)||'[]');
    list.forEach((f,i)=>{
      const d=document.createElement('div');
      d.className='item';
      d.innerHTML=`
        <input type="checkbox" class="big-check" ${f.eaten?'checked':''}>
        <span>${f.name}</span>
        <span onclick="editFood('${meal}',${i})">‚úèÔ∏è</span>`;
      d.querySelector('input').onchange=()=>{f.eaten=!f.eaten;localStorage.setItem(meal,JSON.stringify(list))};
      box.appendChild(d);
    });
  });
}

function editFood(meal,i){
  const list=JSON.parse(localStorage.getItem(meal));
  currentMeal=meal;
  currentFood=i;
  foodName.value=list[i].name;
  foodComp.value=list[i].comp;
  openScreen('foodEditor');
}

/* WATER */
let water=0,goal=0;
function addWater(){
  water+=Number(waterAdd.value||0);
  localStorage.setItem('water',water);
  updateWater();
}
function resetWater(){
  water=0;
  localStorage.setItem('water',0);
  updateWater();
}
function updateWater(){
  goal=Number(waterGoal.value||0);
  waterText.innerText=`${water} / ${goal} –º–ª`;
  waterBar.style.width=goal?Math.min(100,water/goal*100)+'%':'0%';
}

/* WORKOUT */
function addEx(day){
  currentDay=day;
  currentEx=null;
  exName.value='';
  exSets.value='';
  openScreen('workoutEditor');
}
function saveEx(){
  const list=JSON.parse(localStorage.getItem(currentDay)||'[]');
  if(currentEx==null){
    list.push({name:exName.value,sets:exSets.value,done:0});
  }else{
    list[currentEx].name=exName.value;
    list[currentEx].sets=exSets.value;
  }
  localStorage.setItem(currentDay,JSON.stringify(list));
  renderWorkout();
  openScreen('workout');
}
function deleteEx(){
  if(currentEx==null)return;
  const list=JSON.parse(localStorage.getItem(currentDay));
  list.splice(currentEx,1);
  localStorage.setItem(currentDay,JSON.stringify(list));
  renderWorkout();
  openScreen('workout');
}
function renderWorkout(){
  ['mon','wed','fri'].forEach(day=>{
    const box=document.getElementById(day);
    box.innerHTML='';
    const list=JSON.parse(localStorage.getItem(day)||'[]');
    list.forEach((e,i)=>{
      const d=document.createElement('div');
      d.className='item';
      d.innerHTML=`
        <span>${e.name} (${e.done}/${e.sets})</span>
        <button onclick="doSet('${day}',${i})">‚úì</button>
        <span onclick="editEx('${day}',${i})">‚úèÔ∏è</span>`;
      box.appendChild(d);
    });
  });
}
function doSet(day,i){
  const list=JSON.parse(localStorage.getItem(day));
  if(list[i].done<list[i].sets)list[i].done++;
  localStorage.setItem(day,JSON.stringify(list));
  renderWorkout();
}
function editEx(day,i){
  const list=JSON.parse(localStorage.getItem(day));
  currentDay=day;
  currentEx=i;
  exName.value=list[i].name;
  exSets.value=list[i].sets;
  openScreen('workoutEditor');
}

renderFood();
renderWorkout();
updateWater();
</script>
</body>
</html>

