<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">

<meta name="viewport"
content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

<title>Fitness Mini App</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>

<style>
* { box-sizing: border-box; }
body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: #f5f5f5;
}

/* ===== –≠–ö–†–ê–ù–´ ===== */
.screen {
  display: none;
  position: fixed;
  inset: 0;
  background: #f5f5f5;
  padding: 16px;
  overflow-y: auto;
}
.screen.active { display: block; }

h2, h3 { margin-top: 0; }

button {
  padding: 10px;
  font-size: 16px;
  margin-top: 8px;
}

/* ===== –ì–õ–ê–í–ù–´–ô ===== */
#home {
  display: flex;
  flex-direction: column;
  height: 100vh;
}
.home-btn {
  flex: 1;
  background: white;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 24px;
  border-bottom: 1px solid #ddd;
}

/* ===== –ï–î–ê ===== */
.section {
  background: white;
  padding: 10px;
  margin-bottom: 15px;
  border-radius: 8px;
}

.food-item {
  display: flex;
  align-items: center;
  margin-bottom: 8px;
}

.food-item span {
  margin-left: 10px;
  cursor: pointer;
}

/* ===== –ß–ï–ö–ë–û–ö–° ===== */
input[type="checkbox"] {
  width: 22px;
  height: 22px;
}

/* ===== –í–û–î–ê ===== */
.progress {
  height: 16px;
  background: #ddd;
  border-radius: 8px;
  overflow: hidden;
}
.progress div {
  height: 100%;
  background: #4CAF50;
  width: 0%;
}
</style>
</head>

<body>

<!-- ===== –ì–õ–ê–í–ù–´–ô ===== -->
<div id="home" class="screen active">
  <div class="home-btn" onclick="openScreen('food')">üçΩ –ï–î–ê</div>
  <div class="home-btn" onclick="openScreen('workout')">üèãÔ∏è –¢–†–ï–ù–ò–†–û–í–ö–ò</div>
  <div class="home-btn" onclick="openScreen('stats')">üìä –°–¢–ê–¢–ò–°–¢–ò–ö–ê</div>
</div>

<!-- ===== –ï–î–ê ===== -->
<div id="food" class="screen">
<h2>–ï–¥–∞</h2>

<div id="meals"></div>

<!-- –í–û–î–ê -->
<div class="section">
<h3>–í–æ–¥–∞ ‚úèÔ∏è</h3>

<input type="number" id="waterGoalInput" placeholder="–¶–µ–ª—å (–º–ª)">
<button onclick="setWaterGoal()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ü–µ–ª—å</button>

<br><br>
<input type="number" id="waterAdd" placeholder="–í—ã–ø–∏–ª (–º–ª)">
<button onclick="addWater()">+</button>

<p>–í—ã–ø–∏—Ç–æ: <span id="waterDone">0</span> –º–ª</p>
<p>–û—Å—Ç–∞–ª–æ—Å—å: <span id="waterLeft">0</span> –º–ª</p>

<div class="progress"><div id="waterBar"></div></div>

<button onclick="resetWater()">–°–±—Ä–æ—Å–∏—Ç—å –≤–æ–¥—É</button>
</div>

<button onclick="goHome()">‚Üê –ù–∞–∑–∞–¥</button>
</div>

<!-- ===== –†–ï–î–ê–ö–¢–û–† –ë–õ–Æ–î–ê ===== -->
<div id="foodEditor" class="screen">
<h2>–†–µ–¥–∞–∫—Ç–æ—Ä –±–ª—é–¥–∞</h2>

<input id="foodName" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ">
<br><br>
<textarea id="foodComp" placeholder="–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∏ –≥—Ä–∞–º–º—ã"></textarea>

<br>
<button onclick="saveFood()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
<button onclick="deleteFood()">–£–¥–∞–ª–∏—Ç—å</button>
<button onclick="openScreen('food')">‚Üê –ù–∞–∑–∞–¥</button>
</div>

<!-- ===== –¢–†–ï–ù–ò–†–û–í–ö–ò ===== -->
<div id="workout" class="screen">
<h2>–¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏</h2>
<p>–î–æ–±–∞–≤–∏–º –ø–æ–∑–∂–µ —Å—Ç–∞–±–∏–ª—å–Ω–æ</p>
<button onclick="goHome()">‚Üê –ù–∞–∑–∞–¥</button>
</div>

<!-- ===== –°–¢–ê–¢–ò–°–¢–ò–ö–ê ===== -->
<div id="stats" class="screen">
<h2>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h2>
<p>–ë—É–¥–µ—Ç –ø–æ–∑–∂–µ</p>
<button onclick="goHome()">‚Üê –ù–∞–∑–∞–¥</button>
</div>

<script>
Telegram.WebApp.ready();

/* ===== –ù–ê–í–ò–ì–ê–¶–ò–Ø ===== */
function openScreen(id) {
  document.querySelectorAll('.screen')
    .forEach(s => s.classList.remove('active'));
  document.getElementById(id).classList.add('active');
}
function goHome(){ openScreen('home'); }

/* ===== –î–ê–ù–ù–´–ï ===== */
let meals = JSON.parse(localStorage.getItem('meals')) || {
  breakfast: [], lunch: [], dinner: []
};
let currentMeal = '';
let currentIndex = null;

/* ===== –†–ï–ù–î–ï–† –ï–î–´ ===== */
function renderMeals(){
  const names = {
    breakfast:'–ó–∞–≤—Ç—Ä–∞–∫',
    lunch:'–û–±–µ–¥',
    dinner:'–£–∂–∏–Ω'
  };
  mealsDiv = document.getElementById('meals');
  mealsDiv.innerHTML = '';

  for(let key in meals){
    const sec = document.createElement('div');
    sec.className = 'section';
    sec.innerHTML = `<h3>${names[key]}</h3>`;

    meals[key].forEach((f,i)=>{
      const row = document.createElement('div');
      row.className = 'food-item';

      row.innerHTML = `
        <input type="checkbox" ${f.done?'checked':''}
          onchange="toggleDone('${key}',${i})">
        <span onclick="editFood('${key}',${i})">${f.name}</span>
      `;
      sec.appendChild(row);
    });

    const add = document.createElement('button');
    add.textContent = '+ –î–æ–±–∞–≤–∏—Ç—å';
    add.onclick = ()=>addFood(key);
    sec.appendChild(add);

    mealsDiv.appendChild(sec);
  }
}
renderMeals();

/* ===== –ï–î–ê –õ–û–ì–ò–ö–ê ===== */
function addFood(meal){
  currentMeal = meal;
  currentIndex = null;
  foodName.value='';
  foodComp.value='';
  openScreen('foodEditor');
}

function editFood(meal,i){
  currentMeal = meal;
  currentIndex = i;
  foodName.value = meals[meal][i].name;
  foodComp.value = meals[meal][i].comp;
  openScreen('foodEditor');
}

function saveFood(){
  const obj = {
    name: foodName.value,
    comp: foodComp.value,
    done: false
  };
  if(currentIndex===null) meals[currentMeal].push(obj);
  else meals[currentMeal][currentIndex]=obj;

  localStorage.setItem('meals',JSON.stringify(meals));
  renderMeals();
  openScreen('food');
}

function deleteFood(){
  if(currentIndex!==null){
    meals[currentMeal].splice(currentIndex,1);
    localStorage.setItem('meals',JSON.stringify(meals));
  }
  renderMeals();
  openScreen('food');
}

function toggleDone(meal,i){
  meals[meal][i].done = !meals[meal][i].done;
  localStorage.setItem('meals',JSON.stringify(meals));
}

/* ===== –í–û–î–ê ===== */
let waterGoal = Number(localStorage.getItem('waterGoal'))||2000;
let water = Number(localStorage.getItem('water'))||0;

function setWaterGoal(){
  waterGoal = Number(waterGoalInput.value);
  localStorage.setItem('waterGoal',waterGoal);
  updateWater();
}
function addWater(){
  water += Number(waterAdd.value);
  localStorage.setItem('water',water);
  waterAdd.value='';
  updateWater();
}
function resetWater(){
  water = 0;
  localStorage.setItem('water',0);
  updateWater();
}
function updateWater(){
  waterDone.innerText = water;
  waterLeft.innerText = Math.max(waterGoal-water,0);
  waterBar.style.width =
    Math.min(water/waterGoal*100,100)+'%';
}
updateWater();
</script>

</body>
</html>
